数据库：跑在K8S的应用

控制面：对象

## API Server

提供集群管理的REST API接口

提供其他模块之间的数据交互和通信

所有组件的枢纽



## 访问控制概览

每个请求之间都会经过多阶段的访问控制才被接受，包括认证、授权、准入控制

API HTTP handler

Auth

audit 日志

Mutating adminssion - webhook 提供了一些钩子的点，时一个个的https

obj validation

kube aggregator



## 认证

开启TSL时，所有的请求都首先认证，K8S支持多种认证机制，认证通过则进入授权

### X509证书

只要在启动api server时配置--client-ca-file的参数

### 静态token文件

配置csv文件，启动时指定加载token-file

### 引导token

### 静态密码文件

### ServiceAccount

k8s自动生成的，会自动挂载任何容器里面，会有controller自动把token生成出来

### OpenID

### webhook

### 匿名请求



user account和service account的区别，

user account 开发一个webhook跟外部系统对接

service account 建立ns时，自动生成的一个对象



## 构建服务K8S规范的认证服务

认证tokenreview request

规范：URL: https://authn.example.com/authenticate

​	Method:POST

​	Input: 

​	Output：

实战

 	1. 开启一个监听端口
 	2. handler 接受请求的url
 	3. 把body转义成标准的tokenreview对象
 	4. 通过gRPC调用universe本身的鉴权逻辑
 	5. 然后把成功或者失败的结果返回给kubernetes

配置认证参数：

​	需要配置--authentication-token-config-file

是一个kind：config

配置了clusters，配置地址和user

然后再./kube/config

## 鉴权

用于对资源的访问控制

支持一下授权插件：

ABAC

**RBAC**

Webhook

Node



## 转入



## 限流



## APIServer的实现